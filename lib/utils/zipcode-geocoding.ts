/**
 * Utility functions for extracting city and state from zip codes
 * Uses Google Geocoding API as fallback for comprehensive coverage
 */

import { geocodeAddress } from './geocoding';

interface ZipCodeData {
  city: string;
  state: string;
  zipCode: string;
}

// Common zip code to city/state mappings for major cities
const ZIP_CODE_MAP: Record<string, ZipCodeData> = {
  '28202': { city: 'Charlotte', state: 'NC', zipCode: '28202' },
  '28203': { city: 'Charlotte', state: 'NC', zipCode: '28203' },
  '28204': { city: 'Charlotte', state: 'NC', zipCode: '28204' },
  '28205': { city: 'Charlotte', state: 'NC', zipCode: '28205' },
  '28206': { city: 'Charlotte', state: 'NC', zipCode: '28206' },
  '28207': { city: 'Charlotte', state: 'NC', zipCode: '28207' },
  '28208': { city: 'Charlotte', state: 'NC', zipCode: '28208' },
  '28209': { city: 'Charlotte', state: 'NC', zipCode: '28209' },
  '28210': { city: 'Charlotte', state: 'NC', zipCode: '28210' },
  '28211': { city: 'Charlotte', state: 'NC', zipCode: '28211' },
  '28212': { city: 'Charlotte', state: 'NC', zipCode: '28212' },
  '28213': { city: 'Charlotte', state: 'NC', zipCode: '28213' },
  '28214': { city: 'Charlotte', state: 'NC', zipCode: '28214' },
  '28215': { city: 'Charlotte', state: 'NC', zipCode: '28215' },
  '28216': { city: 'Charlotte', state: 'NC', zipCode: '28216' },
  '28217': { city: 'Charlotte', state: 'NC', zipCode: '28217' },
  '28226': { city: 'Charlotte', state: 'NC', zipCode: '28226' },
  '28227': { city: 'Charlotte', state: 'NC', zipCode: '28227' },
  '28244': { city: 'Charlotte', state: 'NC', zipCode: '28244' },
  '28246': { city: 'Charlotte', state: 'NC', zipCode: '28246' },
  '28262': { city: 'Charlotte', state: 'NC', zipCode: '28262' },
  '28269': { city: 'Charlotte', state: 'NC', zipCode: '28269' },
  '28270': { city: 'Charlotte', state: 'NC', zipCode: '28270' },
  '28273': { city: 'Charlotte', state: 'NC', zipCode: '28273' },
  '28277': { city: 'Charlotte', state: 'NC', zipCode: '28277' },
  '28278': { city: 'Charlotte', state: 'NC', zipCode: '28278' },
  '28280': { city: 'Charlotte', state: 'NC', zipCode: '28280' },
  '28282': { city: 'Charlotte', state: 'NC', zipCode: '28282' },
  '28284': { city: 'Charlotte', state: 'NC', zipCode: '28284' },
  '28287': { city: 'Charlotte', state: 'NC', zipCode: '28287' },
  '28290': { city: 'Charlotte', state: 'NC', zipCode: '28290' },
  '28296': { city: 'Charlotte', state: 'NC', zipCode: '28296' },
  '28297': { city: 'Charlotte', state: 'NC', zipCode: '28297' },
  '28299': { city: 'Charlotte', state: 'NC', zipCode: '28299' },
  
  // New York City
  '10001': { city: 'New York', state: 'NY', zipCode: '10001' },
  '10002': { city: 'New York', state: 'NY', zipCode: '10002' },
  '10003': { city: 'New York', state: 'NY', zipCode: '10003' },
  '10004': { city: 'New York', state: 'NY', zipCode: '10004' },
  '10005': { city: 'New York', state: 'NY', zipCode: '10005' },
  '10006': { city: 'New York', state: 'NY', zipCode: '10006' },
  '10007': { city: 'New York', state: 'NY', zipCode: '10007' },
  '10008': { city: 'New York', state: 'NY', zipCode: '10008' },
  '10009': { city: 'New York', state: 'NY', zipCode: '10009' },
  '10010': { city: 'New York', state: 'NY', zipCode: '10010' },
  '10011': { city: 'New York', state: 'NY', zipCode: '10011' },
  '10012': { city: 'New York', state: 'NY', zipCode: '10012' },
  '10013': { city: 'New York', state: 'NY', zipCode: '10013' },
  '10014': { city: 'New York', state: 'NY', zipCode: '10014' },
  '10016': { city: 'New York', state: 'NY', zipCode: '10016' },
  '10017': { city: 'New York', state: 'NY', zipCode: '10017' },
  '10018': { city: 'New York', state: 'NY', zipCode: '10018' },
  '10019': { city: 'New York', state: 'NY', zipCode: '10019' },
  '10020': { city: 'New York', state: 'NY', zipCode: '10020' },
  '10021': { city: 'New York', state: 'NY', zipCode: '10021' },
  '10022': { city: 'New York', state: 'NY', zipCode: '10022' },
  '10023': { city: 'New York', state: 'NY', zipCode: '10023' },
  '10024': { city: 'New York', state: 'NY', zipCode: '10024' },
  '10025': { city: 'New York', state: 'NY', zipCode: '10025' },
  '10026': { city: 'New York', state: 'NY', zipCode: '10026' },
  '10027': { city: 'New York', state: 'NY', zipCode: '10027' },
  '10028': { city: 'New York', state: 'NY', zipCode: '10028' },
  '10029': { city: 'New York', state: 'NY', zipCode: '10029' },
  '10030': { city: 'New York', state: 'NY', zipCode: '10030' },
  '10031': { city: 'New York', state: 'NY', zipCode: '10031' },
  '10032': { city: 'New York', state: 'NY', zipCode: '10032' },
  '10033': { city: 'New York', state: 'NY', zipCode: '10033' },
  '10034': { city: 'New York', state: 'NY', zipCode: '10034' },
  '10035': { city: 'New York', state: 'NY', zipCode: '10035' },
  '10036': { city: 'New York', state: 'NY', zipCode: '10036' },
  '10037': { city: 'New York', state: 'NY', zipCode: '10037' },
  '10038': { city: 'New York', state: 'NY', zipCode: '10038' },
  '10039': { city: 'New York', state: 'NY', zipCode: '10039' },
  '10040': { city: 'New York', state: 'NY', zipCode: '10040' },
  '10041': { city: 'New York', state: 'NY', zipCode: '10041' },
  '10043': { city: 'New York', state: 'NY', zipCode: '10043' },
  '10044': { city: 'New York', state: 'NY', zipCode: '10044' },
  '10045': { city: 'New York', state: 'NY', zipCode: '10045' },
  '10048': { city: 'New York', state: 'NY', zipCode: '10048' },
  '10055': { city: 'New York', state: 'NY', zipCode: '10055' },
  '10060': { city: 'New York', state: 'NY', zipCode: '10060' },
  '10065': { city: 'New York', state: 'NY', zipCode: '10065' },
  '10069': { city: 'New York', state: 'NY', zipCode: '10069' },
  '10075': { city: 'New York', state: 'NY', zipCode: '10075' },
  '10080': { city: 'New York', state: 'NY', zipCode: '10080' },
  '10081': { city: 'New York', state: 'NY', zipCode: '10081' },
  '10087': { city: 'New York', state: 'NY', zipCode: '10087' },
  '10090': { city: 'New York', state: 'NY', zipCode: '10090' },
  '10101': { city: 'New York', state: 'NY', zipCode: '10101' },
  '10102': { city: 'New York', state: 'NY', zipCode: '10102' },
  '10103': { city: 'New York', state: 'NY', zipCode: '10103' },
  '10104': { city: 'New York', state: 'NY', zipCode: '10104' },
  '10105': { city: 'New York', state: 'NY', zipCode: '10105' },
  '10106': { city: 'New York', state: 'NY', zipCode: '10106' },
  '10107': { city: 'New York', state: 'NY', zipCode: '10107' },
  '10108': { city: 'New York', state: 'NY', zipCode: '10108' },
  '10109': { city: 'New York', state: 'NY', zipCode: '10109' },
  '10110': { city: 'New York', state: 'NY', zipCode: '10110' },
  '10111': { city: 'New York', state: 'NY', zipCode: '10111' },
  '10112': { city: 'New York', state: 'NY', zipCode: '10112' },
  '10115': { city: 'New York', state: 'NY', zipCode: '10115' },
  '10118': { city: 'New York', state: 'NY', zipCode: '10118' },
  '10119': { city: 'New York', state: 'NY', zipCode: '10119' },
  '10120': { city: 'New York', state: 'NY', zipCode: '10120' },
  '10121': { city: 'New York', state: 'NY', zipCode: '10121' },
  '10122': { city: 'New York', state: 'NY', zipCode: '10122' },
  '10123': { city: 'New York', state: 'NY', zipCode: '10123' },
  '10128': { city: 'New York', state: 'NY', zipCode: '10128' },
  '10151': { city: 'New York', state: 'NY', zipCode: '10151' },
  '10152': { city: 'New York', state: 'NY', zipCode: '10152' },
  '10153': { city: 'New York', state: 'NY', zipCode: '10153' },
  '10154': { city: 'New York', state: 'NY', zipCode: '10154' },
  '10155': { city: 'New York', state: 'NY', zipCode: '10155' },
  '10158': { city: 'New York', state: 'NY', zipCode: '10158' },
  '10161': { city: 'New York', state: 'NY', zipCode: '10161' },
  '10162': { city: 'New York', state: 'NY', zipCode: '10162' },
  '10165': { city: 'New York', state: 'NY', zipCode: '10165' },
  '10166': { city: 'New York', state: 'NY', zipCode: '10166' },
  '10167': { city: 'New York', state: 'NY', zipCode: '10167' },
  '10168': { city: 'New York', state: 'NY', zipCode: '10168' },
  '10169': { city: 'New York', state: 'NY', zipCode: '10169' },
  '10170': { city: 'New York', state: 'NY', zipCode: '10170' },
  '10171': { city: 'New York', state: 'NY', zipCode: '10171' },
  '10172': { city: 'New York', state: 'NY', zipCode: '10172' },
  '10173': { city: 'New York', state: 'NY', zipCode: '10173' },
  '10174': { city: 'New York', state: 'NY', zipCode: '10174' },
  '10175': { city: 'New York', state: 'NY', zipCode: '10175' },
  '10176': { city: 'New York', state: 'NY', zipCode: '10176' },
  '10177': { city: 'New York', state: 'NY', zipCode: '10177' },
  '10178': { city: 'New York', state: 'NY', zipCode: '10178' },
  '10199': { city: 'New York', state: 'NY', zipCode: '10199' },
  '10203': { city: 'New York', state: 'NY', zipCode: '10203' },
  '10211': { city: 'New York', state: 'NY', zipCode: '10211' },
  '10212': { city: 'New York', state: 'NY', zipCode: '10212' },
  '10213': { city: 'New York', state: 'NY', zipCode: '10213' },
  '10242': { city: 'New York', state: 'NY', zipCode: '10242' },
  '10249': { city: 'New York', state: 'NY', zipCode: '10249' },
  '10256': { city: 'New York', state: 'NY', zipCode: '10256' },
  '10258': { city: 'New York', state: 'NY', zipCode: '10258' },
  '10259': { city: 'New York', state: 'NY', zipCode: '10259' },
  '10260': { city: 'New York', state: 'NY', zipCode: '10260' },
  '10261': { city: 'New York', state: 'NY', zipCode: '10261' },
  '10265': { city: 'New York', state: 'NY', zipCode: '10265' },
  '10268': { city: 'New York', state: 'NY', zipCode: '10268' },
  '10269': { city: 'New York', state: 'NY', zipCode: '10269' },
  '10270': { city: 'New York', state: 'NY', zipCode: '10270' },
  '10271': { city: 'New York', state: 'NY', zipCode: '10271' },
  '10272': { city: 'New York', state: 'NY', zipCode: '10272' },
  '10273': { city: 'New York', state: 'NY', zipCode: '10273' },
  '10274': { city: 'New York', state: 'NY', zipCode: '10274' },
  '10275': { city: 'New York', state: 'NY', zipCode: '10275' },
  '10276': { city: 'New York', state: 'NY', zipCode: '10276' },
  '10277': { city: 'New York', state: 'NY', zipCode: '10277' },
  '10278': { city: 'New York', state: 'NY', zipCode: '10278' },
  '10279': { city: 'New York', state: 'NY', zipCode: '10279' },
  '10280': { city: 'New York', state: 'NY', zipCode: '10280' },
  '10281': { city: 'New York', state: 'NY', zipCode: '10281' },
  '10282': { city: 'New York', state: 'NY', zipCode: '10282' },
  '10285': { city: 'New York', state: 'NY', zipCode: '10285' },
  '10286': { city: 'New York', state: 'NY', zipCode: '10286' },
  '10292': { city: 'New York', state: 'NY', zipCode: '10292' },
  
  // Los Angeles
  '90001': { city: 'Los Angeles', state: 'CA', zipCode: '90001' },
  '90002': { city: 'Los Angeles', state: 'CA', zipCode: '90002' },
  '90003': { city: 'Los Angeles', state: 'CA', zipCode: '90003' },
  '90004': { city: 'Los Angeles', state: 'CA', zipCode: '90004' },
  '90005': { city: 'Los Angeles', state: 'CA', zipCode: '90005' },
  '90006': { city: 'Los Angeles', state: 'CA', zipCode: '90006' },
  '90007': { city: 'Los Angeles', state: 'CA', zipCode: '90007' },
  '90008': { city: 'Los Angeles', state: 'CA', zipCode: '90008' },
  '90009': { city: 'Los Angeles', state: 'CA', zipCode: '90009' },
  '90010': { city: 'Los Angeles', state: 'CA', zipCode: '90010' },
  '90011': { city: 'Los Angeles', state: 'CA', zipCode: '90011' },
  '90012': { city: 'Los Angeles', state: 'CA', zipCode: '90012' },
  '90013': { city: 'Los Angeles', state: 'CA', zipCode: '90013' },
  '90014': { city: 'Los Angeles', state: 'CA', zipCode: '90014' },
  '90015': { city: 'Los Angeles', state: 'CA', zipCode: '90015' },
  '90016': { city: 'Los Angeles', state: 'CA', zipCode: '90016' },
  '90017': { city: 'Los Angeles', state: 'CA', zipCode: '90017' },
  '90018': { city: 'Los Angeles', state: 'CA', zipCode: '90018' },
  '90019': { city: 'Los Angeles', state: 'CA', zipCode: '90019' },
  '90020': { city: 'Los Angeles', state: 'CA', zipCode: '90020' },
  '90021': { city: 'Los Angeles', state: 'CA', zipCode: '90021' },
  '90022': { city: 'Los Angeles', state: 'CA', zipCode: '90022' },
  '90023': { city: 'Los Angeles', state: 'CA', zipCode: '90023' },
  '90024': { city: 'Los Angeles', state: 'CA', zipCode: '90024' },
  '90025': { city: 'Los Angeles', state: 'CA', zipCode: '90025' },
  '90026': { city: 'Los Angeles', state: 'CA', zipCode: '90026' },
  '90027': { city: 'Los Angeles', state: 'CA', zipCode: '90027' },
  '90028': { city: 'Los Angeles', state: 'CA', zipCode: '90028' },
  '90029': { city: 'Los Angeles', state: 'CA', zipCode: '90029' },
  '90030': { city: 'Los Angeles', state: 'CA', zipCode: '90030' },
  '90031': { city: 'Los Angeles', state: 'CA', zipCode: '90031' },
  '90032': { city: 'Los Angeles', state: 'CA', zipCode: '90032' },
  '90033': { city: 'Los Angeles', state: 'CA', zipCode: '90033' },
  '90034': { city: 'Los Angeles', state: 'CA', zipCode: '90034' },
  '90035': { city: 'Los Angeles', state: 'CA', zipCode: '90035' },
  '90036': { city: 'Los Angeles', state: 'CA', zipCode: '90036' },
  '90037': { city: 'Los Angeles', state: 'CA', zipCode: '90037' },
  '90038': { city: 'Los Angeles', state: 'CA', zipCode: '90038' },
  '90039': { city: 'Los Angeles', state: 'CA', zipCode: '90039' },
  '90040': { city: 'Los Angeles', state: 'CA', zipCode: '90040' },
  '90041': { city: 'Los Angeles', state: 'CA', zipCode: '90041' },
  '90042': { city: 'Los Angeles', state: 'CA', zipCode: '90042' },
  '90043': { city: 'Los Angeles', state: 'CA', zipCode: '90043' },
  '90044': { city: 'Los Angeles', state: 'CA', zipCode: '90044' },
  '90045': { city: 'Los Angeles', state: 'CA', zipCode: '90045' },
  '90046': { city: 'Los Angeles', state: 'CA', zipCode: '90046' },
  '90047': { city: 'Los Angeles', state: 'CA', zipCode: '90047' },
  '90048': { city: 'Los Angeles', state: 'CA', zipCode: '90048' },
  '90049': { city: 'Los Angeles', state: 'CA', zipCode: '90049' },
  '90050': { city: 'Los Angeles', state: 'CA', zipCode: '90050' },
  '90051': { city: 'Los Angeles', state: 'CA', zipCode: '90051' },
  '90052': { city: 'Los Angeles', state: 'CA', zipCode: '90052' },
  '90053': { city: 'Los Angeles', state: 'CA', zipCode: '90053' },
  '90054': { city: 'Los Angeles', state: 'CA', zipCode: '90054' },
  '90055': { city: 'Los Angeles', state: 'CA', zipCode: '90055' },
  '90056': { city: 'Los Angeles', state: 'CA', zipCode: '90056' },
  '90057': { city: 'Los Angeles', state: 'CA', zipCode: '90057' },
  '90058': { city: 'Los Angeles', state: 'CA', zipCode: '90058' },
  '90059': { city: 'Los Angeles', state: 'CA', zipCode: '90059' },
  '90060': { city: 'Los Angeles', state: 'CA', zipCode: '90060' },
  '90061': { city: 'Los Angeles', state: 'CA', zipCode: '90061' },
  '90062': { city: 'Los Angeles', state: 'CA', zipCode: '90062' },
  '90063': { city: 'Los Angeles', state: 'CA', zipCode: '90063' },
  '90064': { city: 'Los Angeles', state: 'CA', zipCode: '90064' },
  '90065': { city: 'Los Angeles', state: 'CA', zipCode: '90065' },
  '90066': { city: 'Los Angeles', state: 'CA', zipCode: '90066' },
  '90067': { city: 'Los Angeles', state: 'CA', zipCode: '90067' },
  '90068': { city: 'Los Angeles', state: 'CA', zipCode: '90068' },
  '90069': { city: 'Los Angeles', state: 'CA', zipCode: '90069' },
  '90070': { city: 'Los Angeles', state: 'CA', zipCode: '90070' },
  '90071': { city: 'Los Angeles', state: 'CA', zipCode: '90071' },
  '90072': { city: 'Los Angeles', state: 'CA', zipCode: '90072' },
  '90073': { city: 'Los Angeles', state: 'CA', zipCode: '90073' },
  '90074': { city: 'Los Angeles', state: 'CA', zipCode: '90074' },
  '90075': { city: 'Los Angeles', state: 'CA', zipCode: '90075' },
  '90076': { city: 'Los Angeles', state: 'CA', zipCode: '90076' },
  '90077': { city: 'Los Angeles', state: 'CA', zipCode: '90077' },
  '90078': { city: 'Los Angeles', state: 'CA', zipCode: '90078' },
  '90079': { city: 'Los Angeles', state: 'CA', zipCode: '90079' },
  '90080': { city: 'Los Angeles', state: 'CA', zipCode: '90080' },
  '90081': { city: 'Los Angeles', state: 'CA', zipCode: '90081' },
  '90082': { city: 'Los Angeles', state: 'CA', zipCode: '90082' },
  '90083': { city: 'Los Angeles', state: 'CA', zipCode: '90083' },
  '90084': { city: 'Los Angeles', state: 'CA', zipCode: '90084' },
  '90086': { city: 'Los Angeles', state: 'CA', zipCode: '90086' },
  '90087': { city: 'Los Angeles', state: 'CA', zipCode: '90087' },
  '90088': { city: 'Los Angeles', state: 'CA', zipCode: '90088' },
  '90089': { city: 'Los Angeles', state: 'CA', zipCode: '90089' },
  '90090': { city: 'Los Angeles', state: 'CA', zipCode: '90090' },
  '90091': { city: 'Los Angeles', state: 'CA', zipCode: '90091' },
  '90093': { city: 'Los Angeles', state: 'CA', zipCode: '90093' },
  '90094': { city: 'Los Angeles', state: 'CA', zipCode: '90094' },
  '90095': { city: 'Los Angeles', state: 'CA', zipCode: '90095' },
  '90096': { city: 'Los Angeles', state: 'CA', zipCode: '90096' },
  '90097': { city: 'Los Angeles', state: 'CA', zipCode: '90097' },
  '90099': { city: 'Los Angeles', state: 'CA', zipCode: '90099' },
  
  // Chicago
  '60601': { city: 'Chicago', state: 'IL', zipCode: '60601' },
  '60602': { city: 'Chicago', state: 'IL', zipCode: '60602' },
  '60603': { city: 'Chicago', state: 'IL', zipCode: '60603' },
  '60604': { city: 'Chicago', state: 'IL', zipCode: '60604' },
  '60605': { city: 'Chicago', state: 'IL', zipCode: '60605' },
  '60606': { city: 'Chicago', state: 'IL', zipCode: '60606' },
  '60607': { city: 'Chicago', state: 'IL', zipCode: '60607' },
  '60608': { city: 'Chicago', state: 'IL', zipCode: '60608' },
  '60609': { city: 'Chicago', state: 'IL', zipCode: '60609' },
  '60610': { city: 'Chicago', state: 'IL', zipCode: '60610' },
  '60611': { city: 'Chicago', state: 'IL', zipCode: '60611' },
  '60612': { city: 'Chicago', state: 'IL', zipCode: '60612' },
  '60613': { city: 'Chicago', state: 'IL', zipCode: '60613' },
  '60614': { city: 'Chicago', state: 'IL', zipCode: '60614' },
  '60615': { city: 'Chicago', state: 'IL', zipCode: '60615' },
  '60616': { city: 'Chicago', state: 'IL', zipCode: '60616' },
  '60617': { city: 'Chicago', state: 'IL', zipCode: '60617' },
  '60618': { city: 'Chicago', state: 'IL', zipCode: '60618' },
  '60619': { city: 'Chicago', state: 'IL', zipCode: '60619' },
  '60620': { city: 'Chicago', state: 'IL', zipCode: '60620' },
  '60621': { city: 'Chicago', state: 'IL', zipCode: '60621' },
  '60622': { city: 'Chicago', state: 'IL', zipCode: '60622' },
  '60623': { city: 'Chicago', state: 'IL', zipCode: '60623' },
  '60624': { city: 'Chicago', state: 'IL', zipCode: '60624' },
  '60625': { city: 'Chicago', state: 'IL', zipCode: '60625' },
  '60626': { city: 'Chicago', state: 'IL', zipCode: '60626' },
  '60628': { city: 'Chicago', state: 'IL', zipCode: '60628' },
  '60629': { city: 'Chicago', state: 'IL', zipCode: '60629' },
  '60630': { city: 'Chicago', state: 'IL', zipCode: '60630' },
  '60631': { city: 'Chicago', state: 'IL', zipCode: '60631' },
  '60632': { city: 'Chicago', state: 'IL', zipCode: '60632' },
  '60633': { city: 'Chicago', state: 'IL', zipCode: '60633' },
  '60634': { city: 'Chicago', state: 'IL', zipCode: '60634' },
  '60636': { city: 'Chicago', state: 'IL', zipCode: '60636' },
  '60637': { city: 'Chicago', state: 'IL', zipCode: '60637' },
  '60638': { city: 'Chicago', state: 'IL', zipCode: '60638' },
  '60639': { city: 'Chicago', state: 'IL', zipCode: '60639' },
  '60640': { city: 'Chicago', state: 'IL', zipCode: '60640' },
  '60641': { city: 'Chicago', state: 'IL', zipCode: '60641' },
  '60642': { city: 'Chicago', state: 'IL', zipCode: '60642' },
  '60643': { city: 'Chicago', state: 'IL', zipCode: '60643' },
  '60644': { city: 'Chicago', state: 'IL', zipCode: '60644' },
  '60645': { city: 'Chicago', state: 'IL', zipCode: '60645' },
  '60646': { city: 'Chicago', state: 'IL', zipCode: '60646' },
  '60647': { city: 'Chicago', state: 'IL', zipCode: '60647' },
  '60649': { city: 'Chicago', state: 'IL', zipCode: '60649' },
  '60651': { city: 'Chicago', state: 'IL', zipCode: '60651' },
  '60652': { city: 'Chicago', state: 'IL', zipCode: '60652' },
  '60653': { city: 'Chicago', state: 'IL', zipCode: '60653' },
  '60654': { city: 'Chicago', state: 'IL', zipCode: '60654' },
  '60655': { city: 'Chicago', state: 'IL', zipCode: '60655' },
  '60656': { city: 'Chicago', state: 'IL', zipCode: '60656' },
  '60657': { city: 'Chicago', state: 'IL', zipCode: '60657' },
  '60659': { city: 'Chicago', state: 'IL', zipCode: '60659' },
  '60660': { city: 'Chicago', state: 'IL', zipCode: '60660' },
  '60661': { city: 'Chicago', state: 'IL', zipCode: '60661' },
  '60664': { city: 'Chicago', state: 'IL', zipCode: '60664' },
  '60666': { city: 'Chicago', state: 'IL', zipCode: '60666' },
  '60668': { city: 'Chicago', state: 'IL', zipCode: '60668' },
  '60669': { city: 'Chicago', state: 'IL', zipCode: '60669' },
  '60670': { city: 'Chicago', state: 'IL', zipCode: '60670' },
  '60673': { city: 'Chicago', state: 'IL', zipCode: '60673' },
  '60674': { city: 'Chicago', state: 'IL', zipCode: '60674' },
  '60675': { city: 'Chicago', state: 'IL', zipCode: '60675' },
  '60677': { city: 'Chicago', state: 'IL', zipCode: '60677' },
  '60678': { city: 'Chicago', state: 'IL', zipCode: '60678' },
  '60680': { city: 'Chicago', state: 'IL', zipCode: '60680' },
  '60681': { city: 'Chicago', state: 'IL', zipCode: '60681' },
  '60682': { city: 'Chicago', state: 'IL', zipCode: '60682' },
  '60684': { city: 'Chicago', state: 'IL', zipCode: '60684' },
  '60685': { city: 'Chicago', state: 'IL', zipCode: '60685' },
  '60686': { city: 'Chicago', state: 'IL', zipCode: '60686' },
  '60687': { city: 'Chicago', state: 'IL', zipCode: '60687' },
  '60688': { city: 'Chicago', state: 'IL', zipCode: '60688' },
  '60689': { city: 'Chicago', state: 'IL', zipCode: '60689' },
  '60690': { city: 'Chicago', state: 'IL', zipCode: '60690' },
  '60691': { city: 'Chicago', state: 'IL', zipCode: '60691' },
  '60693': { city: 'Chicago', state: 'IL', zipCode: '60693' },
  '60694': { city: 'Chicago', state: 'IL', zipCode: '60694' },
  '60695': { city: 'Chicago', state: 'IL', zipCode: '60695' },
  '60696': { city: 'Chicago', state: 'IL', zipCode: '60696' },
  '60697': { city: 'Chicago', state: 'IL', zipCode: '60697' },
  '60699': { city: 'Chicago', state: 'IL', zipCode: '60699' },
  
  // Houston
  '77001': { city: 'Houston', state: 'TX', zipCode: '77001' },
  '77002': { city: 'Houston', state: 'TX', zipCode: '77002' },
  '77003': { city: 'Houston', state: 'TX', zipCode: '77003' },
  '77004': { city: 'Houston', state: 'TX', zipCode: '77004' },
  '77005': { city: 'Houston', state: 'TX', zipCode: '77005' },
  '77006': { city: 'Houston', state: 'TX', zipCode: '77006' },
  '77007': { city: 'Houston', state: 'TX', zipCode: '77007' },
  '77008': { city: 'Houston', state: 'TX', zipCode: '77008' },
  '77009': { city: 'Houston', state: 'TX', zipCode: '77009' },
  '77010': { city: 'Houston', state: 'TX', zipCode: '77010' },
  '77011': { city: 'Houston', state: 'TX', zipCode: '77011' },
  '77012': { city: 'Houston', state: 'TX', zipCode: '77012' },
  '77013': { city: 'Houston', state: 'TX', zipCode: '77013' },
  '77014': { city: 'Houston', state: 'TX', zipCode: '77014' },
  '77015': { city: 'Houston', state: 'TX', zipCode: '77015' },
  '77016': { city: 'Houston', state: 'TX', zipCode: '77016' },
  '77017': { city: 'Houston', state: 'TX', zipCode: '77017' },
  '77018': { city: 'Houston', state: 'TX', zipCode: '77018' },
  '77019': { city: 'Houston', state: 'TX', zipCode: '77019' },
  '77020': { city: 'Houston', state: 'TX', zipCode: '77020' },
  '77021': { city: 'Houston', state: 'TX', zipCode: '77021' },
  '77022': { city: 'Houston', state: 'TX', zipCode: '77022' },
  '77023': { city: 'Houston', state: 'TX', zipCode: '77023' },
  '77024': { city: 'Houston', state: 'TX', zipCode: '77024' },
  '77025': { city: 'Houston', state: 'TX', zipCode: '77025' },
  '77026': { city: 'Houston', state: 'TX', zipCode: '77026' },
  '77027': { city: 'Houston', state: 'TX', zipCode: '77027' },
  '77028': { city: 'Houston', state: 'TX', zipCode: '77028' },
  '77029': { city: 'Houston', state: 'TX', zipCode: '77029' },
  '77030': { city: 'Houston', state: 'TX', zipCode: '77030' },
  '77031': { city: 'Houston', state: 'TX', zipCode: '77031' },
  '77032': { city: 'Houston', state: 'TX', zipCode: '77032' },
  '77033': { city: 'Houston', state: 'TX', zipCode: '77033' },
  '77034': { city: 'Houston', state: 'TX', zipCode: '77034' },
  '77035': { city: 'Houston', state: 'TX', zipCode: '77035' },
  '77036': { city: 'Houston', state: 'TX', zipCode: '77036' },
  '77037': { city: 'Houston', state: 'TX', zipCode: '77037' },
  '77038': { city: 'Houston', state: 'TX', zipCode: '77038' },
  '77039': { city: 'Houston', state: 'TX', zipCode: '77039' },
  '77040': { city: 'Houston', state: 'TX', zipCode: '77040' },
  '77041': { city: 'Houston', state: 'TX', zipCode: '77041' },
  '77042': { city: 'Houston', state: 'TX', zipCode: '77042' },
  '77043': { city: 'Houston', state: 'TX', zipCode: '77043' },
  '77044': { city: 'Houston', state: 'TX', zipCode: '77044' },
  '77045': { city: 'Houston', state: 'TX', zipCode: '77045' },
  '77046': { city: 'Houston', state: 'TX', zipCode: '77046' },
  '77047': { city: 'Houston', state: 'TX', zipCode: '77047' },
  '77048': { city: 'Houston', state: 'TX', zipCode: '77048' },
  '77049': { city: 'Houston', state: 'TX', zipCode: '77049' },
  '77050': { city: 'Houston', state: 'TX', zipCode: '77050' },
  '77051': { city: 'Houston', state: 'TX', zipCode: '77051' },
  '77052': { city: 'Houston', state: 'TX', zipCode: '77052' },
  '77053': { city: 'Houston', state: 'TX', zipCode: '77053' },
  '77054': { city: 'Houston', state: 'TX', zipCode: '77054' },
  '77055': { city: 'Houston', state: 'TX', zipCode: '77055' },
  '77056': { city: 'Houston', state: 'TX', zipCode: '77056' },
  '77057': { city: 'Houston', state: 'TX', zipCode: '77057' },
  '77058': { city: 'Houston', state: 'TX', zipCode: '77058' },
  '77059': { city: 'Houston', state: 'TX', zipCode: '77059' },
  '77060': { city: 'Houston', state: 'TX', zipCode: '77060' },
  '77061': { city: 'Houston', state: 'TX', zipCode: '77061' },
  '77062': { city: 'Houston', state: 'TX', zipCode: '77062' },
  '77063': { city: 'Houston', state: 'TX', zipCode: '77063' },
  '77064': { city: 'Houston', state: 'TX', zipCode: '77064' },
  '77065': { city: 'Houston', state: 'TX', zipCode: '77065' },
  '77066': { city: 'Houston', state: 'TX', zipCode: '77066' },
  '77067': { city: 'Houston', state: 'TX', zipCode: '77067' },
  '77068': { city: 'Houston', state: 'TX', zipCode: '77068' },
  '77069': { city: 'Houston', state: 'TX', zipCode: '77069' },
  '77070': { city: 'Houston', state: 'TX', zipCode: '77070' },
  '77071': { city: 'Houston', state: 'TX', zipCode: '77071' },
  '77072': { city: 'Houston', state: 'TX', zipCode: '77072' },
  '77073': { city: 'Houston', state: 'TX', zipCode: '77073' },
  '77074': { city: 'Houston', state: 'TX', zipCode: '77074' },
  '77075': { city: 'Houston', state: 'TX', zipCode: '77075' },
  '77076': { city: 'Houston', state: 'TX', zipCode: '77076' },
  '77077': { city: 'Houston', state: 'TX', zipCode: '77077' },
  '77078': { city: 'Houston', state: 'TX', zipCode: '77078' },
  '77079': { city: 'Houston', state: 'TX', zipCode: '77079' },
  '77080': { city: 'Houston', state: 'TX', zipCode: '77080' },
  '77081': { city: 'Houston', state: 'TX', zipCode: '77081' },
  '77082': { city: 'Houston', state: 'TX', zipCode: '77082' },
  '77083': { city: 'Houston', state: 'TX', zipCode: '77083' },
  '77084': { city: 'Houston', state: 'TX', zipCode: '77084' },
  '77085': { city: 'Houston', state: 'TX', zipCode: '77085' },
  '77086': { city: 'Houston', state: 'TX', zipCode: '77086' },
  '77087': { city: 'Houston', state: 'TX', zipCode: '77087' },
  '77088': { city: 'Houston', state: 'TX', zipCode: '77088' },
  '77089': { city: 'Houston', state: 'TX', zipCode: '77089' },
  '77090': { city: 'Houston', state: 'TX', zipCode: '77090' },
  '77091': { city: 'Houston', state: 'TX', zipCode: '77091' },
  '77092': { city: 'Houston', state: 'TX', zipCode: '77092' },
  '77093': { city: 'Houston', state: 'TX', zipCode: '77093' },
  '77094': { city: 'Houston', state: 'TX', zipCode: '77094' },
  '77095': { city: 'Houston', state: 'TX', zipCode: '77095' },
  '77096': { city: 'Houston', state: 'TX', zipCode: '77096' },
  '77097': { city: 'Houston', state: 'TX', zipCode: '77097' },
  '77098': { city: 'Houston', state: 'TX', zipCode: '77098' },
  '77099': { city: 'Houston', state: 'TX', zipCode: '77099' },
  
  // Phoenix
  '85001': { city: 'Phoenix', state: 'AZ', zipCode: '85001' },
  '85002': { city: 'Phoenix', state: 'AZ', zipCode: '85002' },
  '85003': { city: 'Phoenix', state: 'AZ', zipCode: '85003' },
  '85004': { city: 'Phoenix', state: 'AZ', zipCode: '85004' },
  '85005': { city: 'Phoenix', state: 'AZ', zipCode: '85005' },
  '85006': { city: 'Phoenix', state: 'AZ', zipCode: '85006' },
  '85007': { city: 'Phoenix', state: 'AZ', zipCode: '85007' },
  '85008': { city: 'Phoenix', state: 'AZ', zipCode: '85008' },
  '85009': { city: 'Phoenix', state: 'AZ', zipCode: '85009' },
  '85010': { city: 'Phoenix', state: 'AZ', zipCode: '85010' },
  '85011': { city: 'Phoenix', state: 'AZ', zipCode: '85011' },
  '85012': { city: 'Phoenix', state: 'AZ', zipCode: '85012' },
  '85013': { city: 'Phoenix', state: 'AZ', zipCode: '85013' },
  '85014': { city: 'Phoenix', state: 'AZ', zipCode: '85014' },
  '85015': { city: 'Phoenix', state: 'AZ', zipCode: '85015' },
  '85016': { city: 'Phoenix', state: 'AZ', zipCode: '85016' },
  '85017': { city: 'Phoenix', state: 'AZ', zipCode: '85017' },
  '85018': { city: 'Phoenix', state: 'AZ', zipCode: '85018' },
  '85019': { city: 'Phoenix', state: 'AZ', zipCode: '85019' },
  '85020': { city: 'Phoenix', state: 'AZ', zipCode: '85020' },
  '85021': { city: 'Phoenix', state: 'AZ', zipCode: '85021' },
  '85022': { city: 'Phoenix', state: 'AZ', zipCode: '85022' },
  '85023': { city: 'Phoenix', state: 'AZ', zipCode: '85023' },
  '85024': { city: 'Phoenix', state: 'AZ', zipCode: '85024' },
  '85025': { city: 'Phoenix', state: 'AZ', zipCode: '85025' },
  '85026': { city: 'Phoenix', state: 'AZ', zipCode: '85026' },
  '85027': { city: 'Phoenix', state: 'AZ', zipCode: '85027' },
  '85028': { city: 'Phoenix', state: 'AZ', zipCode: '85028' },
  '85029': { city: 'Phoenix', state: 'AZ', zipCode: '85029' },
  '85030': { city: 'Phoenix', state: 'AZ', zipCode: '85030' },
  '85031': { city: 'Phoenix', state: 'AZ', zipCode: '85031' },
  '85032': { city: 'Phoenix', state: 'AZ', zipCode: '85032' },
  '85033': { city: 'Phoenix', state: 'AZ', zipCode: '85033' },
  '85034': { city: 'Phoenix', state: 'AZ', zipCode: '85034' },
  '85035': { city: 'Phoenix', state: 'AZ', zipCode: '85035' },
  '85036': { city: 'Phoenix', state: 'AZ', zipCode: '85036' },
  '85037': { city: 'Phoenix', state: 'AZ', zipCode: '85037' },
  '85038': { city: 'Phoenix', state: 'AZ', zipCode: '85038' },
  '85039': { city: 'Phoenix', state: 'AZ', zipCode: '85039' },
  '85040': { city: 'Phoenix', state: 'AZ', zipCode: '85040' },
  '85041': { city: 'Phoenix', state: 'AZ', zipCode: '85041' },
  '85042': { city: 'Phoenix', state: 'AZ', zipCode: '85042' },
  '85043': { city: 'Phoenix', state: 'AZ', zipCode: '85043' },
  '85044': { city: 'Phoenix', state: 'AZ', zipCode: '85044' },
  '85045': { city: 'Phoenix', state: 'AZ', zipCode: '85045' },
  '85046': { city: 'Phoenix', state: 'AZ', zipCode: '85046' },
  '85048': { city: 'Phoenix', state: 'AZ', zipCode: '85048' },
  '85050': { city: 'Phoenix', state: 'AZ', zipCode: '85050' },
  '85051': { city: 'Phoenix', state: 'AZ', zipCode: '85051' },
  '85053': { city: 'Phoenix', state: 'AZ', zipCode: '85053' },
  '85054': { city: 'Phoenix', state: 'AZ', zipCode: '85054' },
  '85083': { city: 'Phoenix', state: 'AZ', zipCode: '85083' },
  '85085': { city: 'Phoenix', state: 'AZ', zipCode: '85085' },
  '85086': { city: 'Phoenix', state: 'AZ', zipCode: '85086' },
  '85087': { city: 'Phoenix', state: 'AZ', zipCode: '85087' },
  '85098': { city: 'Phoenix', state: 'AZ', zipCode: '85098' },
  '85099': { city: 'Phoenix', state: 'AZ', zipCode: '85099' },
  
  // New Jersey (including 07011)
  '07001': { city: 'Avenel', state: 'NJ', zipCode: '07001' },
  '07002': { city: 'Bayonne', state: 'NJ', zipCode: '07002' },
  '07003': { city: 'Bloomfield', state: 'NJ', zipCode: '07003' },
  '07004': { city: 'Fairfield', state: 'NJ', zipCode: '07004' },
  '07005': { city: 'Boonton', state: 'NJ', zipCode: '07005' },
  '07006': { city: 'Caldwell', state: 'NJ', zipCode: '07006' },
  '07007': { city: 'Caldwell', state: 'NJ', zipCode: '07007' },
  '07008': { city: 'Carteret', state: 'NJ', zipCode: '07008' },
  '07009': { city: 'Cedar Grove', state: 'NJ', zipCode: '07009' },
  '07010': { city: 'Cliffside Park', state: 'NJ', zipCode: '07010' },
  '07011': { city: 'Clifton', state: 'NJ', zipCode: '07011' },
  '07012': { city: 'Clifton', state: 'NJ', zipCode: '07012' },
  '07013': { city: 'Clifton', state: 'NJ', zipCode: '07013' },
  '07014': { city: 'Clifton', state: 'NJ', zipCode: '07014' },
  '07015': { city: 'Clifton', state: 'NJ', zipCode: '07015' },
  '07016': { city: 'Clifton', state: 'NJ', zipCode: '07016' },
  '07017': { city: 'Clifton', state: 'NJ', zipCode: '07017' },
  '07018': { city: 'Clifton', state: 'NJ', zipCode: '07018' },
  '07019': { city: 'Clifton', state: 'NJ', zipCode: '07019' },
  '07020': { city: 'Clifton', state: 'NJ', zipCode: '07020' },
  '07021': { city: 'Clifton', state: 'NJ', zipCode: '07021' },
  '07022': { city: 'Clifton', state: 'NJ', zipCode: '07022' },
  '07023': { city: 'Clifton', state: 'NJ', zipCode: '07023' },
  '07024': { city: 'Clifton', state: 'NJ', zipCode: '07024' },
  '07025': { city: 'Clifton', state: 'NJ', zipCode: '07025' },
  '07026': { city: 'Clifton', state: 'NJ', zipCode: '07026' },
  '07027': { city: 'Clifton', state: 'NJ', zipCode: '07027' },
  '07028': { city: 'Clifton', state: 'NJ', zipCode: '07028' },
  '07029': { city: 'Clifton', state: 'NJ', zipCode: '07029' },
  '07030': { city: 'Clifton', state: 'NJ', zipCode: '07030' },
  '07031': { city: 'Clifton', state: 'NJ', zipCode: '07031' },
  '07032': { city: 'Clifton', state: 'NJ', zipCode: '07032' },
  '07033': { city: 'Clifton', state: 'NJ', zipCode: '07033' },
  '07034': { city: 'Clifton', state: 'NJ', zipCode: '07034' },
  '07035': { city: 'Clifton', state: 'NJ', zipCode: '07035' },
  '07036': { city: 'Clifton', state: 'NJ', zipCode: '07036' },
  '07037': { city: 'Clifton', state: 'NJ', zipCode: '07037' },
  '07038': { city: 'Clifton', state: 'NJ', zipCode: '07038' },
  '07039': { city: 'Clifton', state: 'NJ', zipCode: '07039' },
  '07040': { city: 'Clifton', state: 'NJ', zipCode: '07040' },
  '07041': { city: 'Clifton', state: 'NJ', zipCode: '07041' },
  '07042': { city: 'Clifton', state: 'NJ', zipCode: '07042' },
  '07043': { city: 'Clifton', state: 'NJ', zipCode: '07043' },
  '07044': { city: 'Clifton', state: 'NJ', zipCode: '07044' },
  '07045': { city: 'Clifton', state: 'NJ', zipCode: '07045' },
  '07046': { city: 'Clifton', state: 'NJ', zipCode: '07046' },
  '07047': { city: 'Clifton', state: 'NJ', zipCode: '07047' },
  '07048': { city: 'Clifton', state: 'NJ', zipCode: '07048' },
  '07049': { city: 'Clifton', state: 'NJ', zipCode: '07049' },
  '07050': { city: 'Clifton', state: 'NJ', zipCode: '07050' },
  '07051': { city: 'Clifton', state: 'NJ', zipCode: '07051' },
  '07052': { city: 'Clifton', state: 'NJ', zipCode: '07052' },
  '07053': { city: 'Clifton', state: 'NJ', zipCode: '07053' },
  '07054': { city: 'Clifton', state: 'NJ', zipCode: '07054' },
  '07055': { city: 'Clifton', state: 'NJ', zipCode: '07055' },
  '07056': { city: 'Clifton', state: 'NJ', zipCode: '07056' },
  '07057': { city: 'Clifton', state: 'NJ', zipCode: '07057' },
  '07058': { city: 'Clifton', state: 'NJ', zipCode: '07058' },
  '07059': { city: 'Clifton', state: 'NJ', zipCode: '07059' },
  '07060': { city: 'Clifton', state: 'NJ', zipCode: '07060' },
  '07061': { city: 'Clifton', state: 'NJ', zipCode: '07061' },
  '07062': { city: 'Clifton', state: 'NJ', zipCode: '07062' },
  '07063': { city: 'Clifton', state: 'NJ', zipCode: '07063' },
  '07064': { city: 'Clifton', state: 'NJ', zipCode: '07064' },
  '07065': { city: 'Clifton', state: 'NJ', zipCode: '07065' },
  '07066': { city: 'Clifton', state: 'NJ', zipCode: '07066' },
  '07067': { city: 'Clifton', state: 'NJ', zipCode: '07067' },
  '07068': { city: 'Clifton', state: 'NJ', zipCode: '07068' },
  '07069': { city: 'Clifton', state: 'NJ', zipCode: '07069' },
  '07070': { city: 'Clifton', state: 'NJ', zipCode: '07070' },
  '07071': { city: 'Clifton', state: 'NJ', zipCode: '07071' },
  '07072': { city: 'Clifton', state: 'NJ', zipCode: '07072' },
  '07073': { city: 'Clifton', state: 'NJ', zipCode: '07073' },
  '07074': { city: 'Clifton', state: 'NJ', zipCode: '07074' },
  '07075': { city: 'Clifton', state: 'NJ', zipCode: '07075' },
  '07076': { city: 'Clifton', state: 'NJ', zipCode: '07076' },
  '07077': { city: 'Clifton', state: 'NJ', zipCode: '07077' },
  '07078': { city: 'Clifton', state: 'NJ', zipCode: '07078' },
  '07079': { city: 'Clifton', state: 'NJ', zipCode: '07079' },
  '07080': { city: 'Clifton', state: 'NJ', zipCode: '07080' },
  '07081': { city: 'Clifton', state: 'NJ', zipCode: '07081' },
  '07082': { city: 'Clifton', state: 'NJ', zipCode: '07082' },
  '07083': { city: 'Clifton', state: 'NJ', zipCode: '07083' },
  '07084': { city: 'Clifton', state: 'NJ', zipCode: '07084' },
  '07085': { city: 'Clifton', state: 'NJ', zipCode: '07085' },
  '07086': { city: 'Clifton', state: 'NJ', zipCode: '07086' },
  '07087': { city: 'Clifton', state: 'NJ', zipCode: '07087' },
  '07088': { city: 'Clifton', state: 'NJ', zipCode: '07088' },
  '07089': { city: 'Clifton', state: 'NJ', zipCode: '07089' },
  '07090': { city: 'Clifton', state: 'NJ', zipCode: '07090' },
  '07091': { city: 'Clifton', state: 'NJ', zipCode: '07091' },
  '07092': { city: 'Clifton', state: 'NJ', zipCode: '07092' },
  '07093': { city: 'Clifton', state: 'NJ', zipCode: '07093' },
  '07094': { city: 'Clifton', state: 'NJ', zipCode: '07094' },
  '07095': { city: 'Clifton', state: 'NJ', zipCode: '07095' },
  '07096': { city: 'Clifton', state: 'NJ', zipCode: '07096' },
  '07097': { city: 'Clifton', state: 'NJ', zipCode: '07097' },
  '07098': { city: 'Clifton', state: 'NJ', zipCode: '07098' },
  '07099': { city: 'Clifton', state: 'NJ', zipCode: '07099' },
};

/**
 * Extract city and state from a zip code
 * First checks local database, then falls back to Google Geocoding API
 * @param zipCode - The zip code string
 * @returns Promise<ZipCodeData | null> - Object with city, state, and zipCode, or null if not found
 */
export async function getCityStateFromZipCode(zipCode: string): Promise<ZipCodeData | null> {
  if (!zipCode || typeof zipCode !== 'string') {
    return null;
  }
  
  // Clean the zip code (remove spaces, dashes, etc.)
  const cleanZipCode = zipCode.replace(/[^0-9]/g, '');
  
  // Check if it's a 5-digit zip code
  if (cleanZipCode.length === 5) {
    const localResult = ZIP_CODE_MAP[cleanZipCode];
    if (localResult) {
      return localResult;
    }
    
    // Fallback to Google Geocoding API
    try {
      console.log(`📍 Zip code ${cleanZipCode} not found locally, using Google Geocoding API`);
      const geocodeResult = await geocodeAddress(cleanZipCode);
      
      if ('error' in geocodeResult) {
        console.warn(`⚠️ Google Geocoding failed for zip ${cleanZipCode}:`, geocodeResult.error);
        return null;
      }
      
      if (geocodeResult.city && geocodeResult.state) {
        console.log(`✅ Google Geocoding success for zip ${cleanZipCode}: ${geocodeResult.city}, ${geocodeResult.state}`);
        return {
          city: geocodeResult.city,
          state: geocodeResult.state,
          zipCode: cleanZipCode
        };
      }
      
      console.warn(`⚠️ Google Geocoding returned incomplete data for zip ${cleanZipCode}`);
      return null;
    } catch (error) {
      console.error(`❌ Google Geocoding error for zip ${cleanZipCode}:`, error);
      return null;
    }
  }
  
  // Check if it's a 9-digit zip code (ZIP+4)
  if (cleanZipCode.length === 9) {
    const fiveDigitZip = cleanZipCode.substring(0, 5);
    const localResult = ZIP_CODE_MAP[fiveDigitZip];
    if (localResult) {
      return localResult;
    }
    
    // Fallback to Google Geocoding API for the 5-digit portion
    try {
      console.log(`📍 ZIP+4 ${cleanZipCode} not found locally, using Google Geocoding API for ${fiveDigitZip}`);
      const geocodeResult = await geocodeAddress(fiveDigitZip);
      
      if ('error' in geocodeResult) {
        console.warn(`⚠️ Google Geocoding failed for zip ${fiveDigitZip}:`, geocodeResult.error);
        return null;
      }
      
      if (geocodeResult.city && geocodeResult.state) {
        console.log(`✅ Google Geocoding success for zip ${fiveDigitZip}: ${geocodeResult.city}, ${geocodeResult.state}`);
        return {
          city: geocodeResult.city,
          state: geocodeResult.state,
          zipCode: fiveDigitZip
        };
      }
      
      console.warn(`⚠️ Google Geocoding returned incomplete data for zip ${fiveDigitZip}`);
      return null;
    } catch (error) {
      console.error(`❌ Google Geocoding error for zip ${fiveDigitZip}:`, error);
      return null;
    }
  }
  
  return null;
}

/**
 * Check if a zip code is valid (5 or 9 digits)
 * @param zipCode - The zip code string
 * @returns boolean indicating if the zip code is valid
 */
export function isValidZipCode(zipCode: string): boolean {
  if (!zipCode || typeof zipCode !== 'string') {
    return false;
  }
  
  const cleanZipCode = zipCode.replace(/[^0-9]/g, '');
  return cleanZipCode.length === 5 || cleanZipCode.length === 9;
}

/**
 * Format a zip code to standard 5-digit format
 * @param zipCode - The zip code string
 * @returns Formatted zip code or null if invalid
 */
export function formatZipCode(zipCode: string): string | null {
  if (!zipCode || typeof zipCode !== 'string') {
    return null;
  }
  
  const cleanZipCode = zipCode.replace(/[^0-9]/g, '');
  
  if (cleanZipCode.length === 5) {
    return cleanZipCode;
  }
  
  if (cleanZipCode.length === 9) {
    return cleanZipCode.substring(0, 5);
  }
  
  return null;
}
